0. 总则

必须：所有需求在开发开始前完成接口契约评审（URL、Method、Query、Body、Header、响应体、错误码、分页、排序、鉴权、幂等键），以OpenAPI 文档为唯一事实来源；任何偏离须走变更评审。

必须：TypeScript strict 模式；不得使用 any/unknown 逃避类型检查；所有跨模块导出符号必须有显式类型。

禁止：在未通过以下四项校验前合并 PR：① 类型检查；② ESLint；③ Prettier；④ 单测/合约测试最小覆盖。

应当：所有规则在 CI 中固化（pre-commit + PR 阻断），任何“线下口头特批”无效。

1. 目录与资源组织

必须 使用如下顶层结构（可根据项目轻微扩展，但不得更名）：
src/components/、src/views/、src/stores/、src/services/、src/router/、src/assets/、src/i18n/、src/utils/、src/types/。

必须 按领域划分视图与服务（如 users/, orders/），禁止以技术层面（“common1”、“misc”等）混放。

禁止 在 src/components 放置与业务强耦合的大型页面；应当 仅存放复用度高的通用组件。

2. 命名与文件规范

必须：变量/函数用 camelCase；类/枚举/类型别名/接口名用 PascalCase；常量用 UPPER_SNAKE_CASE。

必须：Vue 组件文件名与组件名一致，PascalCase.vue；路由组件放 views/，通用组件放 components/。

禁止：为接口（TypeScript interface/type）加 I 前缀（如 IUser）；统一使用业务语义名（User、UserProfile）。

必须：API 模块文件名使用 kebab-case，与资源名一致（如 user-service.ts、order-service.ts）。

3. 接口命名与契约（与后端协作的强制部分）
3.1 路由与资源

必须：采用 REST 风格的复数名词资源路径，语义稳定：

列表 / 过滤：GET /api/v1/users?status=active&page=1&pageSize=20&sort=createdAt,desc

单项：GET /api/v1/users/{id}

新建：POST /api/v1/users

整体替换：PUT /api/v1/users/{id}

部分更新：PATCH /api/v1/users/{id}

删除：DELETE /api/v1/users/{id}

应当：动作型操作用子资源或动作后缀二选一并全项目统一：

子资源：/orders/{id}/cancel

动作后缀：/orders/{id}:cancel
二者只可选其一，禁止混用。

3.2 版本、鉴权、幂等

必须：URL 前缀版本化：/api/v1/...；重大不兼容变更仅能升大版本。

必须：涉及资金/支付/提现/创建订单的写操作，前端必须携带幂等键（例如 Idempotency-Key Header，值为客户端生成的唯一请求 ID）；后端必须把该键作为幂等判定依据；禁止在无幂等策略时发起可重复计费请求。

3.3 参数与时间

必须：分页参数统一 page（从 1 开始），pageSize；响应统一返回 total, items。

必须：时间字段一律采用 ISO 8601 含时区偏移（示例：2025-09-03T10:00:00+08:00）；禁止传递服务端本地化字符串。

应当：过滤字段语义明确且前后端一致（如 status, from, to, createdAt[gte]），避免语义不清的 type, flag。

3.4 响应体与错误

必须：统一响应包结构：{ code: number, message: string, data: object|null, traceId: string }；

成功：HTTP 2xx 且 code=0；

业务失败：HTTP 200 且 code!=0（保留给“业务失败但请求成功”的场景，如校验失败）；

系统失败：HTTP 5xx 或 4xx，code 映射统一错误码表。

必须：错误码三段式并文档化：客户端(1xxx)/业务(2xxx)/系统(5xxx)；前端根据等级决定提示/重试/降级策略。

必须：列表查询响应不得同时返回多种分页模型（如 offset/limit 与 page/pageSize 混用）。

3.5 上传/下载与长任务

必须：文件上传统一使用 multipart/form-data，字段名固定为 file；需要秒传的场景增加 Content-MD5。

应当：批量/长耗时任务返回任务 ID（202 Accepted），前端轮询 GET /tasks/{id}。

4. 网络访问与容错（无代码约束）

必须：所有 HTTP 请求设置显式超时（默认 ≤ 10s，按业务配置）；

必须：GET 请求支持取消（前一次未完成时取消后一次或相反），避免数据闪烁；

必须：对 401/403 统一处理（跳转登录/无权页），对 429/5xx 统一退避重试（指数退避，最大次数受限）；

禁止：在业务组件中直接拼接 URL 字符串；应当 通过集中 services/* 层暴露方法名调用。

必须：请求与响应在控制台默认不打印明文敏感数据；调试开关受环境变量控制并自动脱敏。

5. 组件与模板规范（Vue 3 + Element Plus）

必须：优先 Composition API 与 <script setup>；v-for 必须携带稳定 :key，禁止使用索引当 key。

必须：Props 显式类型、默认值、必填性；Emits 显式声明 事件与负载类型；事件名使用 kebab-case。

必须：双向绑定统一 v-model 语义（主模型 modelValue / update:modelValue）；禁止自定义同义别名。

必须：Element Plus 表单使用 el-form + 规则校验；禁止手写不一致的校验提示与样式；

应当：表格超过 100 行或 10 列时启用虚拟滚动或分页；空数据与加载态必须有明确占位与反馈。

禁止：越权访问或修改子组件内部状态（含 Element Plus 内部私有属性）。

必须：对话框/抽屉统一交互：ESC 关闭、蒙层点击是否可关闭要一致且文档化；危险操作必须二次确认。

6. 路由与权限

必须：路由名称唯一且稳定，用于埋点与面包屑；禁止使用动态生成名。

必须：路由统一懒加载；滚动行为统一处理（切换路由回到顶部，保留滚动的页面需白名单）。

必须：全局前置守卫完成登录态、权限、必需上下文（如组织/项目）校验；禁止在页面内横向重复校验。

7. 状态管理与数据一致性

必须：全局状态使用 Pinia（或与团队约定的状态库），模块按领域拆分；禁止跨模块直接读写。

必须：对可缓存的列表/详情提供请求去重与缓存策略（cacheKey = url+query）；

应当：对频繁刷新数据采用增量更新或乐观更新，并在失败时一致性回滚。

禁止：在 store 内发起与领域无关的网络请求。

8. 文案、国际化与可访问性

必须：所有面向用户的文本走 i18n，不得硬编码在模板中；键名使用 领域.模块.语义 三级结构。

必须：时间、数字、货币使用本地化格式 API；时区行为与后端一致（默认 +08:00），UI 显示采用用户语种偏好。

必须：遵循基本可访问性（焦点可达、键盘操作、语义标签、aria-*），图片必须有 alt。

禁止：颜色对比度不足（对比度 < 4.5:1 的文本）。

9. 样式与主题

必须：样式默认 scoped；命名使用 BEM 或 Token 化（设计系统变量）；

必须：主题/色板通过 Element Plus 主题变量 扩展，不得“野生覆盖”组件内部类名；

禁止：在组件内引入全局样式；仅 src/styles/index.(css|scss) 允许全局入口；

应当：限制 z-index 使用范围，统一分层（如：基础 1–9、浮层 1000、顶层 2000+）。

10. 性能与体验基线

必须：首屏资源体积预算（gzip 后 JS ≤ 300KB/页面，按项目规模可调整并文档化）；

必须：图片/视频按需加载与体积压缩；SVG 优先内联；禁用无损大图直传。

应当：路由级代码分割、按需引入组件与图标；对三方库进行 Tree-shaking 评估。

必须：请求级 Loading 与骨架屏规范：>300ms 显示 Spinner，>800ms 显示 Skeleton，>5s 提供“刷新/重试”。

11. 安全基线

必须：对富文本或外部 HTML 渲染进行 XSS 过滤（白名单策略）；禁止使用 v-html 渲染未净化内容。

必须：前端不存储明文敏感信息（Token、手机号、邮箱等）；必要缓存采用会话级并脱敏。

必须：遵守同源策略与 CSRF 约定；跨域请求携带凭证须与后端 CORS 配置一致且最小化暴露。

应当：启用 CSP 与子资源完整性（SRI）策略；第三方脚本白名单管理。

12. 监控与可观测性

必须：全局错误捕获（运行时错误、资源加载错误、未处理 Promise 拒绝）；

必须：关键操作埋点（进入页面、主要按钮点击、提交成功/失败、接口耗时 P95、首屏时间）；

应当：上报携带 traceId 与路由名、用户匿名 ID、会话信息（合规前提下）。

13. 测试与验收

必须：组件单测覆盖核心交互与状态变迁；接口契约用 合约测试/Schema 校验 验证字段与类型。

必须：页面/流程级 e2e 覆盖高价值路径（登录、下单/支付、提现、资料修改等）。

应当：对视觉稳定性较高的页面启用基础快照或视觉回归测试（按项目成本评估）。

14. 文档与协作流程

必须：接口评审：由后端提交 OpenAPI 草案 → 前端与 QA 共同评审 → 锁定版本 → Mock 环境可用。

必须：破坏性变更流程：开放讨论（RFC）+ 影响面评估 + 双方变更窗口对齐 + 灰度与回滚方案。

必须：每个路由视图保留“功能说明/依赖接口/埋点/风险与边界”四段简要文档；变更随 PR 更新。

应当：在迭代开始前输出“串联清单”（跨端数据与状态流动图）。

15. PR 与 CI 阶段阻断规则（无例外）

必须：

类型检查通过；

ESLint/Prettier 通过（含 plugin:vue/vue3-recommended 与 TS 推荐规则）；

OpenAPI 合约校验通过（字段、类型、必填、示例一致）；

单测/e2e 最小覆盖达标；

体积预算与性能阈值达标；

变更文档与 Changelog 完整；

无敏感词/调试日志 残留。

禁止：CI 失败合并、Review 走过场（需至少一名非提交者 Reviewer 给出“通过”）。

16. 发布与回滚

必须：dev / staging / prod 三套环境；禁止直发 prod。

必须：灰度按“路由/用户/组织”开关粒度；提供一键回滚；

应当：灰度期开启“异常告警 + 体感问题”双通道收集（埋点 + 人工反馈）。

17. 清单（上线前逐项打勾）

合同（OpenAPI）版本 = 代码实现版本

幂等键已在所有“写”接口落地并回归

401/403/429/5xx 统一处理与重试策略生效

Loading/空态/错误态一致、可见

表单校验完整、UI 与文案一致

i18n 覆盖 100%，无硬编码文本

XSS/CSP/SRI 按清单核验

埋点可用，关键指标进看板（PV/UV/转化/耗时/错误率）

体积预算/首屏指标/长任务提示达标

文档、Changelog 与回滚方案齐备